{
  "config": {
    "environment_ini": "[general]\nrefresh_date = 2025-05-08\nuser = chenzhao\nenvironment = \nmo_name = \ndriver_dataset = \ndataproc_project_name = ccg24-hrzana-gds-pacman\ndataproc_storage_bucket = pypl-bkt-rsh-row-std-gds-pacman\nlocal_output_base_path = /projects/gds-packman/apps/ql-store-recommendation-prod/research\ngcs_base_path = gs://${general:dataproc_storage_bucket}/user/${general:user}/prod/ql-store-rmr\nqueue_name = default\nnamespace = gds-packman",
    "solution_ini": "[general]\nmodel_name = RMR_MODEL_ID\ncheck_point = \nemail_to = ${general:user}\nstate_file = \ncosmos_project = ${general:user}\ngcp_app_id = \n\n[driver_creation]\nfile_path = ../config/base_config.yaml\nbq_project_dataset_prefix = config['general_config']['bq_project_dataset_prefix']\ntraining_exclude_merch = config['driver_config']['training_exclude_merch']\ntrain_start_date = config['driver_config']['train_start_date']\noot_start_date = config['driver_config']['oot_start_date']\ntraining_hot_positive_attributed_txn_sampling_alpha = config['driver_config']['training_hot_positive_attributed_txn_sampling_alpha']\ntraining_attributed_txn_upsampling_rate = config['driver_config']['training_attributed_txn_upsampling_rate']\nremoving_highly_active_user_threshold = config['driver_config']['removing_highly_active_user_threshold']\nremoving_highly_active_user_merchant_threshold = config['driver_config']['removing_highly_active_user_merchant_threshold']\nremoving_highly_active_user_merchant_date_threshold = config['driver_config']['removing_highly_active_user_merchant_date_threshold']\ntraining_hot_positive_organic_txn_sampling_alpha = config['driver_config']['training_hot_positive_organic_txn_sampling_alpha']\nval_start_date = config['driver_config']['val_start_date']\nsave_label_mixing_rate = config['driver_config']['save_label_mixing_rate']\nratio_for_hard_negtive = config['driver_config']['ratio_for_hard_negtive']\nhard_negative_impression_time_window = config['driver_config']['hard_negative_impression_time_window']\nnegative_sampling_avoid_delay_postive_feedback_window = config['driver_config']['negative_sampling_avoid_delay_postive_feedback_window']\ntraining_hot_negative_sampling_alpha = config['driver_config']['training_hot_negative_sampling_alpha']\nuniform_negative_postive_ratio = config['driver_config']['uniform_negative_postive_ratio']\ndriver_dev = {bq_prefix}driver_dev\ndriver_oot = {bq_prefix}driver_oot\ndriver_simu = {bq_prefix}driver_simu\ndriver_simu_consumer = {bq_prefix}driver_simu_consumer\n\n[feature_engineering]\nfile_path = ../config/base_config.yaml\nbq_prefix = config['general_config']['bq_project_dataset_prefix']\ntrain_start_date = config['driver_config']['train_start_date']\nfinal_table = {bq_prefix}driver_consumer_base_gender\n\n[data_pulling]\ngcp_project_id = ${general:dataproc_project_name}\ngcs_bucket_name = ${general:dataproc_storage_bucket}\nbq_materialization_project = pypl-bods\nbq_materialization_dataset = rsh_row_gds_pacman\ndriver_loc = ${general:gcs_base_path}/data/ql_store_rmr_driver_simu_consumer\nvariables = ['prmry_addr_state', 'days_on_file', 'ebay_member_y_n', 'consu_engagmnt_seg_key', 'prmry_cc_type_code', 'days_appweb_visit', 'consu_age_band_key', 'consu_income_band_key', 'consu_dmgrphc_seg_key']\nsplit_ratio = {\"train\": 1.0}\nnum_of_splits = 1\ndata_loc = ${general:gcs_base_path}/data/ql_store_rmr_driver_simu_consumer_varmart\n\n[feature_consolidation]\nfile_path = ../config/base_config.yaml\nbq_prefix = config['general_config']['bq_project_dataset_prefix']\ndriver_simu_txn_365d_agg = {bq_prefix}driver_simu_txn_365d_agg\ndriver_consumer_base_last_10_txn = {bq_prefix}driver_consumer_base_last_10_txn\ndriver_consumer_base_all_history_array = {bq_prefix}driver_consumer_base_all_history_array\ndriver_combine_category_agg_3 = {bq_prefix}driver_combine_category_agg_3\ndriver_combine_category_agg_5 = {bq_prefix}driver_combine_category_agg_5\ndriver_merchant_base_price_agg = {bq_prefix}driver_merchant_base_price_agg\ndriver_merchant_base_sales_agg = {bq_prefix}driver_merchant_base_sales_agg\ndriver_elig_save_agg_00 = {bq_prefix}driver_elig_save_agg_00\ndriver_elig_save_agg_0 = {bq_prefix}driver_elig_save_agg_0\ndriver_elig_save_agg_3 = {bq_prefix}driver_elig_save_agg_3\ndriver_merchant_base_click_save = {bq_prefix}driver_merchant_base_click_save\ndriver_consumer_base_gender = {bq_prefix}driver_consumer_base_gender\npypl_bods_gds_pacman_prod_ql_store_honey_merch_quality_scores_external = pypl-bods.gds_pacman_prod.ql_store_honey_merch_quality_scores_external\ndriver_simu_consumer_varmart_external = {bq_prefix}driver_simu_consumer_varmart_external\npypl_bods_gds_pacman_prod_store_recommendation_kg_embedding_32_v2 = pypl-bods.gds_pacman_prod.store_recommendation_kg_embedding_32_v2\ngs = ${general:gcs_base_path}/data/ql_store_rmr_driver_dev_features/part*.parquet\n\n[data_preprocessing]\nmodel_version_base = ../artifacts/din_<today_date>\nexported_feature_transformer = ../artifacts/din_<today_date>/exported_feature_transformer\ndirectory = ../data/ql_store_rmr_driver_dev_features\nparquet_files = List of parquet files in the directory\nstate_to_abbreviation = Dictionary mapping state names to abbreviations\ncategorical_features = ['sndr_consu_engagmnt_seg_key', 'sndr_ebay_member_y_n', 'gender', 'sndr_prmry_cc_type_code', 'sndr_consu_age_band_key', 'sndr_consu_dmgrphc_seg_key']\nnumeric_features = ['sndr_rcvr_txn_num_30d', 'sndr_rcvr_txn_num_180d', 'sndr_rcvr_txn_num_365d', 'sndr_rcvr_txn_amt_30d', 'sndr_rcvr_txn_amt_180d', ...]\nrcvr_id_tokenizer_params = {'num_words': 1000, 'oov_token': '<OOV>'}\noutput_dir = ../data/ql_store_rmr_driver_dev_features_transformed\nchunk_size = 1000000\ntransformed_data_path = ../data/ql_store_rmr_driver_dev_features_transformed\nrcvr_id_tokenizer_path = ../artifacts/din_<today_date>/exported_feature_transformer/rcvr_id_tokenizer\ncategorical_feature_encoders_path = ../artifacts/din_<today_date>/exported_feature_transformer/categorical_feature_encoders\nnumerical_feature_scalars_path = ../artifacts/din_<today_date>/exported_feature_transformer/numerical_feature_scalars\n\n[model_training]\nfile_path = ../config/base_config.yaml\nmodel_version_base = ../artifacts/{model_version}/19\nexported_feature_transformer = ../artifacts/{model_version}/exported_feature_transformer\ndirectory = ../data/ql_store_rmr_driver_dev_features_transformed\nnumeric_names = [\"sndr_rcvr_txn_num_30d\", \"sndr_rcvr_txn_num_180d\", \"sndr_rcvr_txn_num_365d\", ...]\nrcvr_id_names = ['rcvr_id']\ngpt_cate_names = ['gpt_1st_category_l2_index', 'sndr_1st_freq_merchant_category_30d', ...]\nbatch_size = config['training_config']['DIN']['batch_size']\nlearning_rate = config['training_config']['DIN']['learning_rate']\ndnn_use_bn = config['training_config']['DIN']['dnn_use_bn']\ndnn_hidden_units = config['training_config']['DIN']['dnn_hidden_units']\ndnn_activation = config['training_config']['DIN']['dnn_activation']\natt_hidden_size = config['training_config']['DIN']['att_hidden_size']\natt_activation = config['training_config']['DIN']['att_activation']\natt_weight_normalization = config['training_config']['DIN']['att_weight_normalization']\nl2_reg_dnn = config['training_config']['DIN']['l2_reg_dnn']\nl2_reg_embedding = config['training_config']['DIN']['l2_reg_embedding']\ndnn_dropout = config['training_config']['DIN']['dnn_dropout']\nseed = config['training_config']['DIN']['seed']\nepochs = config['training_config']['DIN']['epochs']\nh5_model_path = ../artifacts/{model_version}/19/exported_models/din.h5\ntf_model_path = ../artifacts/{model_version}/19/exported_models/din_saved_model\n\n[model_packaging]\nmodel = `model` (TensorFlow model object)\nexported_model_base = `os.path.join(model_version_base, 'exported_models')`\ninput_mappings = 'hist_gpt_1st_category_l2_index': `[f'hist_gpt_1st_category_{i}' for i in range(1, 101)]`\noutput_mappings = `{model.output.name[:-2]: 'out'}`\ncategorical_feature_encoders = `os.path.join(exported_feature_transformer, 'categorical_feature_encoders')`\nnumerical_feature_scalars = `os.path.join(exported_feature_transformer, 'numerical_feature_scalars')`\ntest_cust = `test_cust` (variable not defined in the provided code)\ntest_date = `test_date` (variable not defined in the provided code)\ntest_df = `data[(data['cust_id'] == test_cust) & (data['run_date'] == test_date)]`\ntest_data_local = `test_data_local` (dictionary created from `test_df`)\ntest_data_tf = `test_data_tf` (dictionary created from `test_df`)\nonnx_output_path = `os.path.join(exported_model_base, 'din.onnx')`\nsaved_model_path = `os.path.join(exported_model_base, 'din_saved_model')`\noutput_file = `./testdata/testdata.json`\nonnx_spec = `onnx_spec.save(exported_model_base)`\nprod_model = `prod_model.save(exported_model_base)`\npath = `exported_model_base + '/din_prod.m'`\ntest_data = `{\"data\": {\"names\": inputs, \"ndarray\": [test_data_local[feat][0] for feat in inputs]}}`\nresults_ort = `sess.run(None, test_data_onnx)`\n\n[model_scoring]\nworking_path = ${general:local_output_base_path}\nparams_path = ${general:local_output_base_path}/config\nsection_name = oot_data_scoring\nmodel_version_path = ${general:local_output_base_path}/_current_model_version\nexported_model_base = ${general:local_output_base_path}/artifacts/{model_version}/exported_models\nm_local_folder = ${general:local_output_base_path}/artifacts/din_20240708/18/exported_models/oot_scoring\nm_gcp_folder = ${general:gcs_base_path}/challenger/oot_scoring\noot_data_path = ${general:gcs_base_path}/data/ql_store_rmr_oot_transformed\neval_path = ${general:gcs_base_path}/data/ql_store_rmr_oot_transformed_scored\neval_result_path = ${general:gcs_base_path}/data/ql_store_rmr_oot_transformed_scored\nlog_file = ${general:local_output_base_path}/logs/{job_id}.log"
  }
}