{
  "node_aggregator": "- Driver Creation:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/00_driver.py\n    line_range: 1-513\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_project_dataset_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      training_exclude_merch: \"config['driver_config']['training_exclude_merch']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n      oot_start_date: \"config['driver_config']['oot_start_date']\"\n      training_hot_positive_attributed_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_attributed_txn_sampling_alpha']\"\n      training_attributed_txn_upsampling_rate: \"config['driver_config']['training_attributed_txn_upsampling_rate']\"\n      removing_highly_active_user_threshold: \"config['driver_config']['removing_highly_active_user_threshold']\"\n      removing_highly_active_user_merchant_threshold: \"config['driver_config']['removing_highly_active_user_merchant_threshold']\"\n      removing_highly_active_user_merchant_date_threshold: \"config['driver_config']['removing_highly_active_user_merchant_date_threshold']\"\n      training_hot_positive_organic_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_organic_txn_sampling_alpha']\"\n      val_start_date: \"config['driver_config']['val_start_date']\"\n      save_label_mixing_rate: \"config['driver_config']['save_label_mixing_rate']\"\n      ratio_for_hard_negtive: \"config['driver_config']['ratio_for_hard_negtive']\"\n      hard_negative_impression_time_window: \"config['driver_config']['hard_negative_impression_time_window']\"\n      negative_sampling_avoid_delay_postive_feedback_window: \"config['driver_config']['negative_sampling_avoid_delay_postive_feedback_window']\"\n      training_hot_negative_sampling_alpha: \"config['driver_config']['training_hot_negative_sampling_alpha']\"\n      uniform_negative_postive_ratio: \"config['driver_config']['uniform_negative_postive_ratio']\"\n    outputs:\n      driver_dev_table: \"{bq_prefix}driver_dev\"\n      driver_oot_table: \"{bq_prefix}driver_oot\"\n- Feature Engineering:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/01_bq_feat.py\n    line_range: 1-819\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n    outputs:\n      final_table: \"{bq_prefix}driver_consumer_base_gender\"\n- Data Pulling:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/01_varmart_feat.py\n    line_range: 1-73\n    inputs:\n      stage: training\n      seq_num: '20231005'\n      is_prod: 'True'\n      job_name: ql_store_rmr\n      group_name: mls_gads\n      model_name: ql_store_rmr_datafetcher\n      model_owner: chenzhao\n      description: ranking_combined_datafetcher\n      manager: Farhad\n      on_gcp: 'True'\n      gcp_project_id: ccg24-hrzana-gds-pacman\n      gcs_bucket_name: pypl-bkt-rsh-row-std-gds-pacman\n      bq_materialization_project: pypl-bods\n      bq_materialization_dataset: rsh_row_gds_pacman\n      driver_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer\n      variables: \"['prmry_addr_state', 'days_on_file', 'ebay_member_y_n', 'consu_engagmnt_seg_key',\\\n        \\ 'prmry_cc_type_code', 'days_appweb_visit', 'consu_age_band_key', 'consu_income_band_key',\\\n        \\ 'consu_dmgrphc_seg_key']\"\n      split_ratio: \"{\\\"train\\\": 1.0}\"\n      num_of_splits: '1'\n    outputs:\n      data_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer_varmart\n- Feature Consolidation:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/02_combine.py\n    line_range: 1-642\n    inputs:\n      config_file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      driver_dev_table: \"{bq_prefix}driver_dev\"\n      driver_simu_txn_365d_agg_table: \"{bq_prefix}driver_simu_txn_365d_agg\"\n      driver_consumer_base_last_10_txn_table: \"{bq_prefix}driver_consumer_base_last_10_txn\"\n      driver_consumer_base_all_history_array_table: \"{bq_prefix}driver_consumer_base_all_history_array\"\n      driver_combine_category_agg_3_table: \"{bq_prefix}driver_combine_category_agg_3\"\n      driver_combine_category_agg_5_table: \"{bq_prefix}driver_combine_category_agg_5\"\n      driver_merchant_base_price_agg_table: \"{bq_prefix}driver_merchant_base_price_agg\"\n      driver_merchant_base_sales_agg_table: \"{bq_prefix}driver_merchant_base_sales_agg\"\n      driver_elig_save_agg_00_table: \"{bq_prefix}driver_elig_save_agg_00\"\n      driver_elig_save_agg_0_table: \"{bq_prefix}driver_elig_save_agg_0\"\n      driver_elig_save_agg_3_table: \"{bq_prefix}driver_elig_save_agg_3\"\n      driver_merchant_base_click_save_table: \"{bq_prefix}driver_merchant_base_click_save\"\n      driver_consumer_base_gender_table: \"{bq_prefix}driver_consumer_base_gender\"\n      ql_store_honey_merch_quality_scores_external_table: pypl-bods.gds_pacman_prod.ql_store_honey_merch_quality_scores_external\n      driver_simu_consumer_varmart_external_table: \"{bq_prefix}driver_simu_consumer_varmart_external\"\n      store_recommendation_kg_embedding_32_v2_table: pypl-bods.gds_pacman_prod.store_recommendation_kg_embedding_32_v2\n      driver_oot_table: \"{bq_prefix}driver_oot\"\n    outputs:\n      driver_dev_features_table: \"{bq_prefix}driver_dev_features\"\n      driver_oot_features_table: \"{bq_prefix}driver_oot_features\"\n      driver_oot_features_expand_seq_table: \"{bq_prefix}driver_oot_features_expand_seq\"\n      export_uri: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_dev_features/part*.parquet\n      export_format: parquet\n      export_overwrite: 'true'\n- Data Preprocessing:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/03_prepare_training_data.py\n    line_range: 1-185\n    inputs:\n      model_version_base: ../artifacts/din_<today_date>\n      directory: ../data/ql_store_rmr_driver_dev_features\n      parquet_files: \"[list of parquet files in the directory]\"\n      state_to_abbreviation: \"{ 'ALABAMA': 'AL', 'ALASKA': 'AK', ... }\"\n      categorical_features: \"['sndr_consu_engagmnt_seg_key', 'sndr_ebay_member_y_n',\\\n        \\ 'gender', 'sndr_prmry_cc_type_code', 'sndr_consu_age_band_key', 'sndr_consu_dmgrphc_seg_key']\"\n      numeric_features: \"['sndr_rcvr_txn_num_30d', 'sndr_rcvr_txn_num_180d', 'sndr_rcvr_txn_num_365d',\\\n        \\ ...]\"\n      maxlen: '100'\n      num_words: '1000'\n      oov_token: <OOV>\n      chunk_size: '1000000'\n      output_dir: ../data/ql_store_rmr_driver_dev_features_transformed\n    outputs:\n      model_version: din_<today_date>\n      exported_feature_transformer: ../artifacts/din_<today_date>/exported_feature_transformer\n      state_encoder_dict: \"{ 'AL': 0, 'AK': 1, ... }\"\n      categorical_feature_encoders: \"{ 'sndr_consu_engagmnt_seg_key': { 'class1':\\\n        \\ 0, 'class2': 1, ... }, ... }\"\n      numerical_feature_scalars: \"{ 'sndr_rcvr_txn_num_30d': { 'mean': <value>, 'std':\\\n        \\ <value> }, ... }\"\n      rcvr_id_tokenizer: ../artifacts/din_<today_date>/exported_feature_transformer/rcvr_id_tokenizer\n      categorical_feature_encoders_path: ../artifacts/din_<today_date>/exported_feature_transformer/categorical_feature_encoders\n      numerical_feature_scalars_path: ../artifacts/din_<today_date>/exported_feature_transformer/numerical_feature_scalars\n- Model Training:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/04_training.py\n    line_range: 1-175\n    inputs:\n      config_file_path: ../config/base_config.yaml\n      model_version_file_path: ../_current_model_version\n      data_directory: ../data/ql_store_rmr_driver_dev_features_transformed\n      numeric_names: \"[\\\"sndr_rcvr_txn_num_30d\\\", \\\"sndr_rcvr_txn_num_180d\\\", \\\"sndr_rcvr_txn_num_365d\\\"\\\n        , \\\"sndr_rcvr_txn_amt_30d\\\", \\\"sndr_rcvr_txn_amt_180d\\\", ...]\"\n      rcvr_id_names: \"['rcvr_id']\"\n      gpt_cate_names: \"['gpt_1st_category_l2_index', 'sndr_1st_freq_merchant_category_30d',\\\n        \\ 'sndr_2nd_freq_merchant_category_30d', ...]\"\n      batch_size: \"config['training_config']['DIN']['batch_size']\"\n      learning_rate: \"config['training_config']['DIN']['learning_rate']\"\n      dnn_use_bn: \"config['training_config']['DIN']['dnn_use_bn']\"\n      dnn_hidden_units: \"config['training_config']['DIN']['dnn_hidden_units']\"\n      dnn_activation: \"config['training_config']['DIN']['dnn_activation']\"\n      att_hidden_size: \"config['training_config']['DIN']['att_hidden_size']\"\n      att_activation: \"config['training_config']['DIN']['att_activation']\"\n      att_weight_normalization: \"config['training_config']['DIN']['att_weight_normalization']\"\n      l2_reg_dnn: \"config['training_config']['DIN']['l2_reg_dnn']\"\n      l2_reg_embedding: \"config['training_config']['DIN']['l2_reg_embedding']\"\n      dnn_dropout: \"config['training_config']['DIN']['dnn_dropout']\"\n      seed: \"config['training_config']['DIN']['seed']\"\n      epochs: \"config['training_config']['DIN']['epochs']\"\n    outputs:\n      h5_model_path: \"../artifacts/{model_version}/19/exported_models/din.h5\"\n      tf_model_path: \"../artifacts/{model_version}/19/exported_models/din_saved_model\"\n- Model Packaging:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/04_training.py\n    line_range: 176-269\n    inputs:\n      tf_model_path: \"../artifacts/{model_version}/19/exported_models/din_saved_model\"\n      exported_model_base: \"../artifacts/{model_version}/19/exported_models\"\n      categorical_feature_encoders_path: \"../artifacts/{model_version}/exported_feature_transformer/categorical_feature_encoders\"\n      rcvr_id_tokenizer_path: \"../artifacts/{model_version}/exported_feature_transformer/rcvr_id_tokenizer\"\n      numerical_feature_scalars_path: \"../artifacts/{model_version}/exported_feature_transformer/numerical_feature_scalars\"\n    outputs:\n      onnx_spec_path: \"../artifacts/{model_version}/19/exported_models\"\n      oot_scoring_directory: \"../artifacts/{model_version}/19/exported_models/oot_scoring\"\n      onnx_model_path: \"../artifacts/{model_version}/19/exported_models/tf_2_onnx_model.m\"\n      renamed_onnx_model_path: \"../artifacts/{model_version}/19/exported_models/oot_scoring/din_expand_seq.m\"\n      prod_model_path: \"../artifacts/{model_version}/19/exported_models/din_prod.m\"\n      test_data_json_path: ./testdata/testdata.json\n      onnx_output_path: \"../artifacts/{model_version}/19/exported_models/din.onnx\"\n- Model Scoring:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/05_scoring_oot.py\n    line_range: 1-104\n    inputs:\n      working_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research\n      params_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/config\n      section_name: oot_data_scoring\n      model_version_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/_current_model_version\n      exported_model_base: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/{model_version}/exported_models\"\n      m_local_folder: /projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/din_20240708/18/exported_models/oot_scoring\n      m_gcp_folder: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/challenger/oot_scoring\n      oot_data_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed\n      eval_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n    outputs:\n      eval_result_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n      log_file: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/logs/{job_id}.log\"\n- Load Model Version:\n    file_name: research/driver_creation.ipynb\n    line_range: Lines 258-311\n    inputs:\n      model_version_path: ../_current_model_version\n      model_artifacts_base_path: ../artifacts/\n    outputs:\n      model_version: \"[Loaded from file]\"\n- Load Configuration:\n    file_name: research/driver_creation.ipynb\n    line_range: Lines 258-311\n    inputs:\n      config_file_path: ../config/base_config.yaml\n    outputs:\n      config: \"[Loaded from file]\"\n- Create BigQuery Tables:\n    file_name: research/driver_creation.ipynb\n    line_range: Lines 258-311\n    inputs:\n      bq_project_dataset_prefix: \"[Loaded from config]\"\n      oot_start_date: \"[Loaded from config]\"\n    outputs:\n      bq_table_driver_oot_txn_365d: \"{bq_prefix}driver_oot_txn_365d\"\n      bq_table_driver_oot_txn_save_365d: \"{bq_prefix}driver_oot_txn_save_365d\"\n      bq_table_mlv2_gpt_similar_map_snapshot: \"{bq_prefix}mlv2_gpt_similar_map_snapshot\"\n      bq_table_mlv2_gpt_similar_map_snapshot_1: \"{bq_prefix}mlv2_gpt_similar_map_snapshot_1\"\n      bq_table_driver_oot_txn_save_365d_similar: \"{bq_prefix}driver_oot_txn_save_365d_similar\"\n      bq_table_driver_oot_txn_save_365d_similar_dedup: \"{bq_prefix}driver_oot_txn_save_365d_similar_dedup\"\n      bq_table_driver_oot_two_tower_similar_score: \"{bq_prefix}driver_oot_two_tower_similar_score\"\n      bq_table_driver_oot_hueristic_model_comparison: \"{bq_prefix}driver_oot_hueristic_model_comparison\"\n- Export Evaluation Readouts:\n    file_name: research/driver_creation.ipynb\n    line_range: Lines 258-311\n    inputs:\n      exported_eval_readout_base: \"[Constructed from model_version_base]\"\n    outputs:\n      performance_all_csv: performane_all.csv\n      performance_all_png: performane_all.png\n      performance_ftu_csv: performane_ftu.csv\n      performance_ftu_png: performane_ftu.png\n      performance_wo_ebay_csv: performane_wo_ebay.csv\n      performance_wo_ebay_png: performane_wo_ebay.png\n"
}