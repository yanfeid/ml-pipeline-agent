{
  "node_aggregator": "- Driver Creation:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/00_driver.ipynb\n    line_range: Lines 4-512\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      training_exclude_merch: \"config['driver_config']['training_exclude_merch']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n      oot_start_date: \"config['driver_config']['oot_start_date']\"\n      val_start_date: \"config['driver_config']['val_start_date']\"\n      training_hot_positive_attributed_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_attributed_txn_sampling_alpha']\"\n      training_attributed_txn_upsampling_rate: \"config['driver_config']['training_attributed_txn_upsampling_rate']\"\n      removing_highly_active_user_threshold: \"config['driver_config']['removing_highly_active_user_threshold']\"\n      removing_highly_active_user_merchant_threshold: \"config['driver_config']['removing_highly_active_user_merchant_threshold']\"\n      removing_highly_active_user_merchant_date_threshold: \"config['driver_config']['removing_highly_active_user_merchant_date_threshold']\"\n      training_hot_positive_organic_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_organic_txn_sampling_alpha']\"\n      save_label_mixing_rate: \"config['driver_config']['save_label_mixing_rate']\"\n      ratio_for_hard_negtive: \"config['driver_config']['ratio_for_hard_negtive']\"\n      hard_negative_impression_time_window: \"config['driver_config']['hard_negative_impression_time_window']\"\n      negative_sampling_avoid_delay_postive_feedback_window: \"config['driver_config']['negative_sampling_avoid_delay_postive_feedback_window']\"\n      training_hot_negative_sampling_alpha: \"config['driver_config']['training_hot_negative_sampling_alpha']\"\n      uniform_negative_postive_ratio: \"config['driver_config']['uniform_negative_postive_ratio']\"\n    outputs:\n      live_unique_merchants_train: \"{bq_prefix}live_unique_merchants_train\"\n      driver_00: \"{bq_prefix}driver_00\"\n      driver_0: \"{bq_prefix}driver_0\"\n      driver_1: \"{bq_prefix}driver_1\"\n      driver_positive_train_attributed: \"{bq_prefix}driver_positive_train_attributed\"\n      driver_positive_train_organic_0: \"{bq_prefix}driver_positive_train_organic_0\"\n      driver_positive_train_organic: \"{bq_prefix}driver_positive_train_organic\"\n      driver_positive: \"{bq_prefix}driver_positive\"\n      driver_positive_training_split_0: \"{bq_prefix}driver_positive_training_split_0\"\n      driver_positive_training_split: \"{bq_prefix}driver_positive_training_split\"\n      driver_training_hard_negative: \"{bq_prefix}driver_training_hard_negative\"\n      driver_training_hard_negative_downsample: \"{bq_prefix}driver_training_hard_negative_downsample\"\n      driver_training_uniform_negative: \"{bq_prefix}driver_training_uniform_negative\"\n      driver_training_uniform_negative_remove_window_positive: \"{bq_prefix}driver_training_uniform_negative_remove_window_positive\"\n      driver_training_uniform_negative_downsample_0: \"{bq_prefix}driver_training_uniform_negative_downsample_0\"\n      driver_training_uniform_negative_downsample: \"{bq_prefix}driver_training_uniform_negative_downsample\"\n      driver_dev: \"{bq_prefix}driver_dev\"\n      driver_oot_uniform_negative_0: \"{bq_prefix}driver_oot_uniform_negative_0\"\n      driver_oot_uniform_negative: \"{bq_prefix}driver_oot_uniform_negative\"\n      driver_oot: \"{bq_prefix}driver_oot\"\n      driver_simu: \"{bq_prefix}driver_simu\"\n      driver_simu_consumer: \"{bq_prefix}driver_simu_consumer\"\n- Feature Engineering:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/01_bq_feat.ipynb\n    line_range: Lines 17-817\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n    outputs:\n      driver_simu_txn_365d_table: \"{bq_prefix}driver_simu_txn_365d\"\n      driver_simu_txn_365d_agg_table: \"{bq_prefix}driver_simu_txn_365d_agg\"\n      driver_consumer_base_table: \"{bq_prefix}driver_consumer_base\"\n      driver_consumer_base_txn_5k_merch_category_table: \"{bq_prefix}driver_consumer_base_txn_5k_merch_category\"\n      driver_consumer_base_last_10_txn_table: \"{bq_prefix}driver_consumer_base_last_10_txn\"\n      driver_consumer_base_all_history_array_0_table: \"{bq_prefix}driver_consumer_base_all_history_array_0\"\n      driver_consumer_base_all_history_array_table: \"{bq_prefix}driver_consumer_base_all_history_array\"\n      driver_combine_category_table: \"{bq_prefix}driver_combine_category\"\n      driver_combine_category_agg_0_table: \"{bq_prefix}driver_combine_category_agg_0\"\n      driver_combine_category_agg_1_table: \"{bq_prefix}driver_combine_category_agg_1\"\n      driver_combine_category_agg_2_table: \"{bq_prefix}driver_combine_category_agg_2\"\n      driver_combine_category_agg_3_table: \"{bq_prefix}driver_combine_category_agg_3\"\n      driver_combine_category_agg_4_table: \"{bq_prefix}driver_combine_category_agg_4\"\n      driver_combine_category_agg_5_table: \"{bq_prefix}driver_combine_category_agg_5\"\n      driver_merchant_base_table: \"{bq_prefix}driver_merchant_base\"\n      driver_merchant_base_txn_30d_table: \"{bq_prefix}driver_merchant_base_txn_30d\"\n      driver_merchant_base_txn_30d_filter_sndr_table: \"{bq_prefix}driver_merchant_base_txn_30d_filter_sndr\"\n      driver_merchant_base_price_agg_table: \"{bq_prefix}driver_merchant_base_price_agg\"\n      driver_merchant_base_sales_agg_table: \"{bq_prefix}driver_merchant_base_sales_agg\"\n      driver_elig_save_365d_category_table: \"{bq_prefix}driver_elig_save_365d_category\"\n      driver_elig_save_agg_00_table: \"{bq_prefix}driver_elig_save_agg_00\"\n      driver_elig_save_agg_0_table: \"{bq_prefix}driver_elig_save_agg_0\"\n      driver_elig_save_agg_1_table: \"{bq_prefix}driver_elig_save_agg_1\"\n      driver_elig_save_agg_2_table: \"{bq_prefix}driver_elig_save_agg_2\"\n      driver_elig_save_agg_3_table: \"{bq_prefix}driver_elig_save_agg_3\"\n      driver_merchant_base_click_save_table: \"{bq_prefix}driver_merchant_base_click_save\"\n      driver_consumer_base_gender_table: \"{bq_prefix}driver_consumer_base_gender\"\n- Data Pulling:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/01_varmart_feat.ipynb\n    line_range: Lines 23-67\n    inputs:\n      stage: training\n      seq_num: '20231005'\n      is_prod: 'True'\n      job_name: ql_store_rmr\n      group_name: mls_gads\n      model_name: ql_store_rmr_datafetcher\n      model_owner: chenzhao\n      description: ranking_combined_datafetcher\n      manager: Farhad\n      on_gcp: 'True'\n      gcp_project_id: ccg24-hrzana-gds-pacman\n      gcs_bucket_name: pypl-bkt-rsh-row-std-gds-pacman\n      bq_materialization_project: pypl-bods\n      bq_materialization_dataset: rsh_row_gds_pacman\n      driver_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer\n      variables: \"[\\\"prmry_addr_state\\\", \\\"days_on_file\\\", \\\"ebay_member_y_n\\\", \\\"\\\n        consu_engagmnt_seg_key\\\", \\\"prmry_cc_type_code\\\", \\\"days_appweb_visit\\\", \\\"\\\n        consu_age_band_key\\\", \\\"consu_income_band_key\\\", \\\"consu_dmgrphc_seg_key\\\"\\\n        ]\"\n      split_ratio: \"{\\\"train\\\": 1.0}\"\n      num_of_splits: '1'\n    outputs:\n      data_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer_varmart\n- Feature Consolidation:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/02_combine.ipynb\n    line_range: Lines 17-624\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n    outputs:\n      driver_dev_features_table: \"{bq_prefix}driver_dev_features\"\n      driver_oot_features_table: \"{bq_prefix}driver_oot_features\"\n      driver_oot_features_expand_seq_table: \"{bq_prefix}driver_oot_features_expand_seq\"\n      export_uri: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_dev_features/part*.parquet\n- Data Preprocessing:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/03_prepare_training_data.ipynb\n    line_range: Lines 21-175\n    inputs:\n      model_version_base: ../artifacts/din_<today_date>\n      directory: ../data/ql_store_rmr_driver_dev_features\n      parquet_files: \"[\\\"file1.parquet\\\", \\\"file2.parquet\\\", ...]\"\n      state_to_abbreviation: \"{\\\"ALABAMA\\\": \\\"AL\\\", \\\"ALASKA\\\": \\\"AK\\\", ...}\"\n      categorical_features: \"[\\\"sndr_consu_engagmnt_seg_key\\\", \\\"sndr_ebay_member_y_n\\\"\\\n        , \\\"gender\\\", ...]\"\n      numeric_features: \"[\\\"sndr_rcvr_txn_num_30d\\\", \\\"sndr_rcvr_txn_num_180d\\\", ...]\"\n      rcvr_id_tokenizer_params: \"{\\\"num_words\\\": 1000, \\\"oov_token\\\": \\\"<OOV>\\\"}\"\n      chunk_size: '1000000'\n    outputs:\n      model_version: din_<today_date>\n      exported_feature_transformer: ../artifacts/din_<today_date>/exported_feature_transformer\n      output_dir: ../data/ql_store_rmr_driver_dev_features_transformed\n      rcvr_id_tokenizer_path: ../artifacts/din_<today_date>/exported_feature_transformer/rcvr_id_tokenizer\n      categorical_feature_encoders_path: ../artifacts/din_<today_date>/exported_feature_transformer/categorical_feature_encoders\n      numerical_feature_scalars_path: ../artifacts/din_<today_date>/exported_feature_transformer/numerical_feature_scalars\n- Model Training:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/04_training.ipynb\n    line_range: Lines 140-170\n    inputs:\n      train_data_path: ../data/ql_store_rmr_driver_dev_features_transformed\n      numeric_names: \"[\\\"sndr_rcvr_txn_num_30d\\\", \\\"sndr_rcvr_txn_num_180d\\\", \\\"sndr_rcvr_txn_num_365d\\\"\\\n        , ...]\"\n      rcvr_id_names: \"[\\\"rcvr_id\\\"]\"\n      gpt_cate_names: \"[\\\"gpt_1st_category_l2_index\\\", \\\"sndr_1st_freq_merchant_category_30d\\\"\\\n        , ...]\"\n      batch_size: \"config['training_config']['DIN']['batch_size']\"\n      learning_rate: \"config['training_config']['DIN']['learning_rate']\"\n      dnn_use_bn: \"config['training_config']['DIN']['dnn_use_bn']\"\n      dnn_hidden_units: \"config['training_config']['DIN']['dnn_hidden_units']\"\n      dnn_activation: \"config['training_config']['DIN']['dnn_activation']\"\n      att_hidden_size: \"config['training_config']['DIN']['att_hidden_size']\"\n      att_activation: \"config['training_config']['DIN']['att_activation']\"\n      att_weight_normalization: \"config['training_config']['DIN']['att_weight_normalization']\"\n      l2_reg_dnn: \"config['training_config']['DIN']['l2_reg_dnn']\"\n      l2_reg_embedding: \"config['training_config']['DIN']['l2_reg_embedding']\"\n      dnn_dropout: \"config['training_config']['DIN']['dnn_dropout']\"\n      seed: \"config['training_config']['DIN']['seed']\"\n      epochs: \"config['training_config']['DIN']['epochs']\"\n    outputs:\n      model_artifact_path: \"os.path.join(exported_model_base, 'din.h5')\"\n      tf_model_path: \"os.path.join(exported_model_base, 'din_saved_model')\"\n- Model Packaging:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/04_training.ipynb\n    line_range: Lines 171-185\n    inputs:\n      trained_model_path: \"os.path.join(exported_model_base, 'din_saved_model')\"\n    outputs:\n      onnx_model_path: \"os.path.join(exported_model_base, 'din.onnx')\"\n      oot_scoring_path: \"os.path.join(exported_model_base, 'oot_scoring')\"\n      prod_model_path: \"os.path.join(exported_model_base, 'din_prod.m')\"\n- Model Scoring:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/05_scoring_oot.ipynb\n    line_range: Lines 25-94\n    inputs:\n      working_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research\n      params_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/config\n      section_name: oot_data_scoring\n      model_version_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/_current_model_version\n      exported_model_base: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/{model_version}/exported_models\"\n      m_local_folder: /projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/din_20240708/18/exported_models/oot_scoring\n      m_gcp_folder: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/challenger/oot_scoring\n      oot_data_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed\n      eval_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n    outputs:\n      eval_result_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n      log_file: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/logs/{job_id}.log\"\n- Model Evaluation:\n    file_name: repos/ql-store-recommendation-prod/research/pipeline/06_evaluation.ipynb\n    line_range: Lines 375-731\n    inputs:\n      model_version_path: ../_current_model_version\n      model_version_base: \"../artifacts/{model_version}/18\"\n      config_file_path: ../config/base_config.yaml\n      bq_project_dataset_prefix: \"{config['general_config']['bq_project_dataset_prefix']}\"\n      oot_start_date: \"{config['driver_config']['oot_start_date']}\"\n      remove_list: \"'1365556366671835703','2254348706417584521','1581565211190403045','1157330454984142772','1339933886421356550','1812170125034785903','6053464759929799123','1587111025150613712','1672368731209095395','1365556366671835703','6085552794250364378','1954349237309389875'\"\n    outputs:\n      exported_eval_readout_base: \"../artifacts/{model_version}/18/exported_eval_readouts\"\n      performance_all_csv: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_all.csv\"\n      performance_all_png: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_all.png\"\n      performance_ftu_csv: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_ftu.csv\"\n      performance_ftu_png: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_ftu.png\"\n      performance_wo_ebay_csv: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_wo_ebay.csv\"\n      performance_wo_ebay_png: \"../artifacts/{model_version}/18/exported_eval_readouts/performane_wo_ebay.png\"\n"
}