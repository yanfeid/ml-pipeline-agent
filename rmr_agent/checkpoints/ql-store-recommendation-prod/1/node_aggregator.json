{
  "node_aggregator": "- Driver Creation:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/00_driver.py\n    line_range: Lines 1-513\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_project_dataset_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      training_exclude_merch: \"config['driver_config']['training_exclude_merch']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n      oot_start_date: \"config['driver_config']['oot_start_date']\"\n      training_hot_positive_attributed_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_attributed_txn_sampling_alpha']\"\n      training_attributed_txn_upsampling_rate: \"config['driver_config']['training_attributed_txn_upsampling_rate']\"\n      removing_highly_active_user_threshold: \"config['driver_config']['removing_highly_active_user_threshold']\"\n      removing_highly_active_user_merchant_threshold: \"config['driver_config']['removing_highly_active_user_merchant_threshold']\"\n      removing_highly_active_user_merchant_date_threshold: \"config['driver_config']['removing_highly_active_user_merchant_date_threshold']\"\n      training_hot_positive_organic_txn_sampling_alpha: \"config['driver_config']['training_hot_positive_organic_txn_sampling_alpha']\"\n      val_start_date: \"config['driver_config']['val_start_date']\"\n      save_label_mixing_rate: \"config['driver_config']['save_label_mixing_rate']\"\n      ratio_for_hard_negtive: \"config['driver_config']['ratio_for_hard_negtive']\"\n      hard_negative_impression_time_window: \"config['driver_config']['hard_negative_impression_time_window']\"\n      negative_sampling_avoid_delay_postive_feedback_window: \"config['driver_config']['negative_sampling_avoid_delay_postive_feedback_window']\"\n      training_hot_negative_sampling_alpha: \"config['driver_config']['training_hot_negative_sampling_alpha']\"\n      uniform_negative_postive_ratio: \"config['driver_config']['uniform_negative_postive_ratio']\"\n    outputs:\n      driver_dev: \"{bq_prefix}driver_dev\"\n      driver_oot: \"{bq_prefix}driver_oot\"\n      driver_simu: \"{bq_prefix}driver_simu\"\n      driver_simu_consumer: \"{bq_prefix}driver_simu_consumer\"\n- Feature Engineering:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/01_bq_feat.py\n    line_range: 1-819\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      train_start_date: \"config['driver_config']['train_start_date']\"\n    outputs:\n      final_table: \"{bq_prefix}driver_consumer_base_gender\"\n- Data Pulling:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/01_varmart_feat.py\n    line_range: 1-73\n    inputs:\n      gcp_project_id: ccg24-hrzana-gds-pacman\n      gcs_bucket_name: pypl-bkt-rsh-row-std-gds-pacman\n      bq_materialization_project: pypl-bods\n      bq_materialization_dataset: rsh_row_gds_pacman\n      driver_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer\n      variables: \"['prmry_addr_state', 'days_on_file', 'ebay_member_y_n', 'consu_engagmnt_seg_key',\\\n        \\ 'prmry_cc_type_code', 'days_appweb_visit', 'consu_age_band_key', 'consu_income_band_key',\\\n        \\ 'consu_dmgrphc_seg_key']\"\n      split_ratio: \"{\\\"train\\\": 1.0}\"\n      num_of_splits: '1'\n    outputs:\n      data_loc: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_simu_consumer_varmart\n- Feature Consolidation:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/02_combine.py\n    line_range: 1-642\n    inputs:\n      file_path: ../config/base_config.yaml\n      bq_prefix: \"config['general_config']['bq_project_dataset_prefix']\"\n      \"{bq_prefix}driver_dev\": \"{bq_prefix}driver_dev\"\n      \"{bq_prefix}driver_simu_txn_365d_agg\": \"{bq_prefix}driver_simu_txn_365d_agg\"\n      \"{bq_prefix}driver_consumer_base_last_10_txn\": \"{bq_prefix}driver_consumer_base_last_10_txn\"\n      \"{bq_prefix}driver_consumer_base_all_history_array\": \"{bq_prefix}driver_consumer_base_all_history_array\"\n      \"{bq_prefix}driver_combine_category_agg_3\": \"{bq_prefix}driver_combine_category_agg_3\"\n      \"{bq_prefix}driver_combine_category_agg_5\": \"{bq_prefix}driver_combine_category_agg_5\"\n      \"{bq_prefix}driver_merchant_base_price_agg\": \"{bq_prefix}driver_merchant_base_price_agg\"\n      \"{bq_prefix}driver_merchant_base_sales_agg\": \"{bq_prefix}driver_merchant_base_sales_agg\"\n      \"{bq_prefix}driver_elig_save_agg_00\": \"{bq_prefix}driver_elig_save_agg_00\"\n      \"{bq_prefix}driver_elig_save_agg_0\": \"{bq_prefix}driver_elig_save_agg_0\"\n      \"{bq_prefix}driver_elig_save_agg_3\": \"{bq_prefix}driver_elig_save_agg_3\"\n      \"{bq_prefix}driver_merchant_base_click_save\": \"{bq_prefix}driver_merchant_base_click_save\"\n      \"{bq_prefix}driver_consumer_base_gender\": \"{bq_prefix}driver_consumer_base_gender\"\n      pypl-bods.gds_pacman_prod.ql_store_honey_merch_quality_scores_external: pypl-bods.gds_pacman_prod.ql_store_honey_merch_quality_scores_external\n      \"{bq_prefix}driver_simu_consumer_varmart_external\": \"{bq_prefix}driver_simu_consumer_varmart_external\"\n      pypl-bods.gds_pacman_prod.store_recommendation_kg_embedding_32_v2: pypl-bods.gds_pacman_prod.store_recommendation_kg_embedding_32_v2\n    outputs:\n      gs: '//pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_dev_features/part*.parquet:\n        gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_driver_dev_features/part*.parquet'\n- Data Preprocessing:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/03_prepare_training_data.py\n    line_range: 1-185\n    inputs:\n      model_version_base: ../artifacts/din_<today_date>\n      exported_feature_transformer: ../artifacts/din_<today_date>/exported_feature_transformer\n      directory: ../data/ql_store_rmr_driver_dev_features\n      parquet_files: List of parquet files in the directory\n      state_to_abbreviation: Dictionary mapping state names to abbreviations\n      categorical_features: \"['sndr_consu_engagmnt_seg_key', 'sndr_ebay_member_y_n',\\\n        \\ 'gender', 'sndr_prmry_cc_type_code', 'sndr_consu_age_band_key', 'sndr_consu_dmgrphc_seg_key']\"\n      numeric_features: \"['sndr_rcvr_txn_num_30d', 'sndr_rcvr_txn_num_180d', 'sndr_rcvr_txn_num_365d',\\\n        \\ 'sndr_rcvr_txn_amt_30d', 'sndr_rcvr_txn_amt_180d', ... (abbreviated)]\"\n      rcvr_id_tokenizer_params: \"{'num_words': 1000, 'oov_token': '<OOV>'}\"\n      output_dir: ../data/ql_store_rmr_driver_dev_features_transformed\n      chunk_size: '1000000'\n    outputs:\n      transformed_data_path: ../data/ql_store_rmr_driver_dev_features_transformed\n      rcvr_id_tokenizer_path: ../artifacts/din_<today_date>/exported_feature_transformer/rcvr_id_tokenizer\n      categorical_feature_encoders_path: ../artifacts/din_<today_date>/exported_feature_transformer/categorical_feature_encoders\n      numerical_feature_scalars_path: ../artifacts/din_<today_date>/exported_feature_transformer/numerical_feature_scalars\n- Model Training:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/04_training.py\n    line_range: 1-170\n    inputs:\n      file_path: ../config/base_config.yaml\n      model_version_base: \"../artifacts/{model_version}/19\"\n      exported_feature_transformer: \"../artifacts/{model_version}/exported_feature_transformer\"\n      directory: ../data/ql_store_rmr_driver_dev_features_transformed\n      numeric_names: \"[\\\"sndr_rcvr_txn_num_30d\\\", \\\"sndr_rcvr_txn_num_180d\\\", \\\"sndr_rcvr_txn_num_365d\\\"\\\n        , ...]\"\n      rcvr_id_names: \"['rcvr_id']\"\n      gpt_cate_names: \"['gpt_1st_category_l2_index', 'sndr_1st_freq_merchant_category_30d',\\\n        \\ ...]\"\n      batch_size: \"config['training_config']['DIN']['batch_size']\"\n      learning_rate: \"config['training_config']['DIN']['learning_rate']\"\n      dnn_use_bn: \"config['training_config']['DIN']['dnn_use_bn']\"\n      dnn_hidden_units: \"config['training_config']['DIN']['dnn_hidden_units']\"\n      dnn_activation: \"config['training_config']['DIN']['dnn_activation']\"\n      att_hidden_size: \"config['training_config']['DIN']['att_hidden_size']\"\n      att_activation: \"config['training_config']['DIN']['att_activation']\"\n      att_weight_normalization: \"config['training_config']['DIN']['att_weight_normalization']\"\n      l2_reg_dnn: \"config['training_config']['DIN']['l2_reg_dnn']\"\n      l2_reg_embedding: \"config['training_config']['DIN']['l2_reg_embedding']\"\n      dnn_dropout: \"config['training_config']['DIN']['dnn_dropout']\"\n      seed: \"config['training_config']['DIN']['seed']\"\n      epochs: \"config['training_config']['DIN']['epochs']\"\n    outputs:\n      h5_model_path: \"../artifacts/{model_version}/19/exported_models/din.h5\"\n      tf_model_path: \"../artifacts/{model_version}/19/exported_models/din_saved_model\"\n- Model Packaging:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/04_training.py\n    line_range: 171-269\n    inputs:\n      model: '`model` (TensorFlow model object)'\n      exported_model_base: \"`os.path.join(model_version_base, 'exported_models')`\"\n      input_mappings: \"'hist_gpt_1st_category_l2_index': `[f'hist_gpt_1st_category_{i}'\\\n        \\ for i in range(1, 101)]`\"\n      output_mappings: \"`{model.output.name[:-2]: 'out'}`\"\n      categorical_feature_encoders: \"`os.path.join(exported_feature_transformer, 'categorical_feature_encoders')`\"\n      numerical_feature_scalars: \"`os.path.join(exported_feature_transformer, 'numerical_feature_scalars')`\"\n      test_cust: '`test_cust` (variable not defined in the provided code)'\n      test_date: '`test_date` (variable not defined in the provided code)'\n      test_df: \"`data[(data['cust_id'] == test_cust) & (data['run_date'] == test_date)]`\"\n      test_data_local: '`test_data_local` (dictionary created from `test_df`)'\n      test_data_tf: '`test_data_tf` (dictionary created from `test_df`)'\n      onnx_output_path: \"`os.path.join(exported_model_base, 'din.onnx')`\"\n      saved_model_path: \"`os.path.join(exported_model_base, 'din_saved_model')`\"\n      output_file: '`./testdata/testdata.json`'\n    outputs:\n      h5_model_path: \"`os.path.join(exported_model_base, 'din.h5')`\"\n      tf_model_path: \"`os.path.join(exported_model_base, 'din_saved_model')`\"\n      onnx_spec: '`onnx_spec.save(exported_model_base)`'\n      prod_model: '`prod_model.save(exported_model_base)`'\n      path: '`exported_model_base + ''/din_prod.m''`'\n      test_data: \"`{\\\"data\\\": {\\\"names\\\": inputs, \\\"ndarray\\\": [test_data_local[feat][0]\\\n        \\ for feat in inputs]}}`\"\n      onnx_output_path: \"`os.path.join(exported_model_base, 'din.onnx')`\"\n      results_ort: \"`sess.run(None, test_data_onnx)`\"\n- Model Scoring:\n    file_name: rmr_agent/repos/ql-store-recommendation-prod/research/pipeline/05_scoring_oot.py\n    line_range: 1-104\n    inputs:\n      working_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research\n      params_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/config\n      section_name: oot_data_scoring\n      model_version_path: /projects/gds-packman/apps/ql-store-recommendation-prod/research/_current_model_version\n      exported_model_base: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/{model_version}/exported_models\"\n      m_local_folder: /projects/gds-packman/apps/ql-store-recommendation-prod/research/artifacts/din_20240708/18/exported_models/oot_scoring\n      m_gcp_folder: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/challenger/oot_scoring\n      oot_data_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed\n      eval_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n    outputs:\n      eval_result_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/chenzhao/prod/ql-store-rmr/data/ql_store_rmr_oot_transformed_scored\n      log_file: \"/projects/gds-packman/apps/ql-store-recommendation-prod/research/logs/{job_id}.log\"\n- Component Name:\n    file_name: research/driver_creation.ipynb\n    line_range: Lines 258-311\n    inputs:\n      input_data: The dataset to be processed\n      config: Configuration settings for the processing\n    outputs:\n      processed_data: The resulting dataset after processing\n      log: Log information about the processing steps\n"
}