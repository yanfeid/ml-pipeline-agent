nodes:
- Driver Creation 1:
    file_name: rmr_agent/repos/bt-retry-v2/etl/01_etl.py
    line_range: 1-1125
    inputs:
      Source Table: pypl-edl.braintree_raw_tables.gateway_custom_actions_settings
      Date Range: 2023-01-01' to '2025-01-02
    outputs:
      Final Driver Table: pypl-edw.pp_scratch.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3
- Driver Creation 2:
    file_name: rmr_agent/repos/bt-retry-v2/etl/02_bq_to_dataproc.py
    line_range: 1-40
    inputs:
      source_table_name: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test
      spark.jars: gs://spark-lib/bigquery/spark-bigquery-with-dependencies_2.12-0.18.1.jar
      spark.executor.extraClassPath: spark-bigquery-with-dependencies_2.12-0.18.1.jar
      spark.driver.extraClassPath: spark-bigquery-with-dependencies_2.12-0.18.1.jar
      spark.conf.set("viewsEnabled"): 'true'
      spark.conf.set("materializationProject"): pypl-edw
      spark.conf.set("materializationDataset"): pp_scratch
      spark.conf.set('temporaryGcsBucket'): pypl-bkt-rsh-row-std-gds-pacman
    outputs:
      target_gcs_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2
- Model Training:
    file_name: rmr_agent/repos/bt-retry-v2/model-dev/train.py
    line_range: 1-367
    inputs:
      TRAIN_PARQUET_PATH: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_train_3/
      VAL_PARQUET_PATH: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_valid_3/
      V2_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features.txt
      V1_LATEST_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v0_features_latest.txt
      numerical_columns: "['setec_txn_amt_usd', 'idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d',\
        \ ...] (abbreviated)"
      integer_columns: "[]"
      encoded_columns: "[]"
      categorical_columns: "['merchant_fk', 'setec_currency_code', 'primary_response_type',\
        \ ...] (abbreviated)"
      target_col: retry_is_success
      features: "['setec_txn_amt_usd', 'idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d',\
        \ ...] (abbreviated)"
      EARLY_STOPPING_PARAMS: "{\"stopping_rounds\": 10}"
      EARLY_STOPPING_METRIC: average_precision
      METRIC_FUNCTIONS: "[precision_at_95, precision_at_99, savings_at_95, savings_at_99,\
        \ partial_aucpr_geq90]"
      METRIC_NAMES: "[\"precision_at_95\", \"precision_at_99\", \"savings_at_95\"\
        , \"savings_at_99\", \"partial_aucpr_geq90\"]"
      OBJECTIVE_METRIC_NAME: partial_aucpr_geq90
      best_params: "{'colsample_bytree': 0.5837239684404587, 'learning_rate': 0.0598927112458938,\
        \ 'min_child_samples': 61, 'min_data_in_bin': 25, 'num_leaves': 217, 'num_trees':\
        \ 141, 'n_estimators': 141, 'n_jobs': 8, 'reg_alpha': 4.784258485091152e-08,\
        \ 'reg_lambda': 0.0002699654851946926, 'subsample': 0.6899589770039457, 'subsample_freq':\
        \ 5}"
    outputs:
      Model artifact path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt
- Model Evaluation:
    file_name: rmr_agent/repos/bt-retry-v2/model-dev/evaluate.py
    line_range: 1-383
    inputs:
      DATA_PATH: /projects/dnaomi/bt-retry-global-refresh/data/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3/
      V1_FEATURES_PATH: /projects/dnaomi/bt-retry-global-refresh/metadata/features_original.txt
      V1_MODEL_PATH: /projects/dnaomi/bt-retry-global/models/lgbm/original_lgbm/original_model.txt
      V2_FEATURES_PATH: /projects/dnaomi/bt-retry-global-refresh/metadata/v2_features_final_2.txt
      V2_MODEL_PATH: /projects/dnaomi/bt-retry-global-refresh/models/final/bt_retry_v2.txt
      numerical_columns: "[\"setec_txn_amt_usd\", \"idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d\"\
        , ...] (abbreviated)"
      integer_columns: "[]"
      categorical_columns: "[\"merchant_fk\", \"setec_currency_code\", \"primary_response_type\"\
        , ...] (abbreviated)"
      target_col: retry_is_success
      METRIC_FUNCTIONS: "[precision_at_95, precision_at_99, precision_at_995, savings_at_95,\
        \ savings_at_99, savings_at_995, partial_aucpr_geq90]"
      METRIC_NAMES: "[\"precision_at_95\", \"precision_at_99\", \"precision_at_995\"\
        , \"savings_at_95\", \"savings_at_99\", \"savings_at_995\", \"partial_aucpr_geq90\"\
        ]"
    outputs:
      valid_data_filtered_final.csv: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv
- Model Packaging:
    file_name: rmr_agent/repos/bt-retry-v2/deployment/01_export_to_ume.py
    line_range: 1-60
    inputs:
      FULL_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features_final_2.txt
      categorical_columns: "[\"merchant_fk\", \"setec_currency_code\", \"primary_response_type\"\
        , \"processor_settings_type\", \"retry_strategy_type\", \"card_type\", \"\
        fi_usage\", \"issuer\", \"bin\", \"issuer_cntry_code\", \"is_recurring_txn\"\
        , \"payment_instrument_type\", \"is_cvv_present\", \"enrollment_status\",\
        \ \"token_status\", \"vaulted_credential_type\", \"mcc_code\", \"liability_shift_possible\"\
        , \"success_3ds\", \"verifications_txn\", \"fastlane_txn\"]"
      model_file: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_small.txt
      path_to_json: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json
      model_name: bt_retry_v2
      tree_nodes_only: 'False'
      output_name: bt_retry_v2_score
    outputs:
      model_json_with_pd_path: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json
      output_path: /projects/dnaomi/bt-retry-global-v2/models/ume/
- Model Scoring:
    file_name: rmr_agent/repos/bt-retry-v2/deployment/02_pyscoring_validation.py
    line_range: 1-140
    inputs:
      numerical_columns: "[\"setec_txn_amt_usd\", \"idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d\"\
        , ...]"
      integer_columns: "[]"
      categorical_columns: "[\"merchant_fk\", \"setec_currency_code\", \"primary_response_type\"\
        , ...]"
      target_col: retry_is_success
      MODELS_DIR: /home/dnaomi/bt-retry-global-refresh/models/ume/
      MODEL_DIR: /home/dnaomi/bt-retry-global-refresh/models/ume/
      MODEL_UME_NAME: bt_retry_v2
      VALID_SAMPLE_PATH: /home/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv
    outputs:
      ume_predictions_valid: DataFrame with UME model predictions
      ume_preds_filtered: DataFrame with filtered UME model predictions
      scored_data_path: /projects/dnaomi/bt-retry-global-refresh/deployment/cosmos_ai_valid_data.csv

edges:
- from: Driver Creation 1
  to: Model Evaluation
  attributes:
    Final Driver Table: pypl-edw.pp_scratch.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3
- from: Driver Creation 2
  to: Model Training
  attributes:
    target_gcs_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2
- from: Model Training
  to: Model Evaluation
  attributes:
    Model artifact path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt
- from: Model Evaluation
  to: Model Scoring
  attributes:
    valid_data_filtered_final.csv: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv
- from: Model Packaging
  to: Model Scoring
  attributes:
    output_path: /projects/dnaomi/bt-retry-global-v2/models/ume/