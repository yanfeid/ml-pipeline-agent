{
  "dag_yaml": "nodes:\n- Driver Creation 1:\n    file_name: rmr_agent/repos/bt-retry-v2/etl/01_etl.py\n    line_range: 1-1125\n    inputs:\n      Source Table: pypl-edl.braintree_raw_tables.gateway_custom_actions_settings\n      Date Range: 2023-01-01' to '2025-01-02\n    outputs:\n      Final Driver Table: pypl-edw.pp_scratch.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3\n- Driver Creation 2:\n    file_name: rmr_agent/repos/bt-retry-v2/etl/02_bq_to_dataproc.py\n    line_range: 1-40\n    inputs:\n      source_table_name: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test\n      spark.jars: gs://spark-lib/bigquery/spark-bigquery-with-dependencies_2.12-0.18.1.jar\n      spark.executor.extraClassPath: spark-bigquery-with-dependencies_2.12-0.18.1.jar\n      spark.driver.extraClassPath: spark-bigquery-with-dependencies_2.12-0.18.1.jar\n      spark.conf.set(\"viewsEnabled\"): 'true'\n      spark.conf.set(\"materializationProject\"): pypl-edw\n      spark.conf.set(\"materializationDataset\"): pp_scratch\n      spark.conf.set('temporaryGcsBucket'): pypl-bkt-rsh-row-std-gds-pacman\n    outputs:\n      target_gcs_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2\n- Model Training:\n    file_name: rmr_agent/repos/bt-retry-v2/model-dev/train.py\n    line_range: 1-367\n    inputs:\n      TRAIN_PARQUET_PATH: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_train_3/\n      VAL_PARQUET_PATH: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_valid_3/\n      V2_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features.txt\n      V1_LATEST_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v0_features_latest.txt\n      numerical_columns: \"['setec_txn_amt_usd', 'idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d',\\\n        \\ ...] (abbreviated)\"\n      integer_columns: \"[]\"\n      encoded_columns: \"[]\"\n      categorical_columns: \"['merchant_fk', 'setec_currency_code', 'primary_response_type',\\\n        \\ ...] (abbreviated)\"\n      target_col: retry_is_success\n      features: \"['setec_txn_amt_usd', 'idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d',\\\n        \\ ...] (abbreviated)\"\n      EARLY_STOPPING_PARAMS: \"{\\\"stopping_rounds\\\": 10}\"\n      EARLY_STOPPING_METRIC: average_precision\n      METRIC_FUNCTIONS: \"[precision_at_95, precision_at_99, savings_at_95, savings_at_99,\\\n        \\ partial_aucpr_geq90]\"\n      METRIC_NAMES: \"[\\\"precision_at_95\\\", \\\"precision_at_99\\\", \\\"savings_at_95\\\"\\\n        , \\\"savings_at_99\\\", \\\"partial_aucpr_geq90\\\"]\"\n      OBJECTIVE_METRIC_NAME: partial_aucpr_geq90\n      best_params: \"{'colsample_bytree': 0.5837239684404587, 'learning_rate': 0.0598927112458938,\\\n        \\ 'min_child_samples': 61, 'min_data_in_bin': 25, 'num_leaves': 217, 'num_trees':\\\n        \\ 141, 'n_estimators': 141, 'n_jobs': 8, 'reg_alpha': 4.784258485091152e-08,\\\n        \\ 'reg_lambda': 0.0002699654851946926, 'subsample': 0.6899589770039457, 'subsample_freq':\\\n        \\ 5}\"\n    outputs:\n      Model artifact path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt\n- Model Evaluation:\n    file_name: rmr_agent/repos/bt-retry-v2/model-dev/evaluate.py\n    line_range: 1-383\n    inputs:\n      DATA_PATH: /projects/dnaomi/bt-retry-global-refresh/data/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3/\n      V1_FEATURES_PATH: /projects/dnaomi/bt-retry-global-refresh/metadata/features_original.txt\n      V1_MODEL_PATH: /projects/dnaomi/bt-retry-global/models/lgbm/original_lgbm/original_model.txt\n      V2_FEATURES_PATH: /projects/dnaomi/bt-retry-global-refresh/metadata/v2_features_final_2.txt\n      V2_MODEL_PATH: /projects/dnaomi/bt-retry-global-refresh/models/final/bt_retry_v2.txt\n      numerical_columns: \"[\\\"setec_txn_amt_usd\\\", \\\"idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d\\\"\\\n        , ...] (abbreviated)\"\n      integer_columns: \"[]\"\n      categorical_columns: \"[\\\"merchant_fk\\\", \\\"setec_currency_code\\\", \\\"primary_response_type\\\"\\\n        , ...] (abbreviated)\"\n      target_col: retry_is_success\n      METRIC_FUNCTIONS: \"[precision_at_95, precision_at_99, precision_at_995, savings_at_95,\\\n        \\ savings_at_99, savings_at_995, partial_aucpr_geq90]\"\n      METRIC_NAMES: \"[\\\"precision_at_95\\\", \\\"precision_at_99\\\", \\\"precision_at_995\\\"\\\n        , \\\"savings_at_95\\\", \\\"savings_at_99\\\", \\\"savings_at_995\\\", \\\"partial_aucpr_geq90\\\"\\\n        ]\"\n    outputs:\n      valid_data_filtered_final.csv: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv\n- Model Packaging:\n    file_name: rmr_agent/repos/bt-retry-v2/deployment/01_export_to_ume.py\n    line_range: 1-60\n    inputs:\n      FULL_FEATURES_PATH: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features_final_2.txt\n      categorical_columns: \"[\\\"merchant_fk\\\", \\\"setec_currency_code\\\", \\\"primary_response_type\\\"\\\n        , \\\"processor_settings_type\\\", \\\"retry_strategy_type\\\", \\\"card_type\\\", \\\"\\\n        fi_usage\\\", \\\"issuer\\\", \\\"bin\\\", \\\"issuer_cntry_code\\\", \\\"is_recurring_txn\\\"\\\n        , \\\"payment_instrument_type\\\", \\\"is_cvv_present\\\", \\\"enrollment_status\\\",\\\n        \\ \\\"token_status\\\", \\\"vaulted_credential_type\\\", \\\"mcc_code\\\", \\\"liability_shift_possible\\\"\\\n        , \\\"success_3ds\\\", \\\"verifications_txn\\\", \\\"fastlane_txn\\\"]\"\n      model_file: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_small.txt\n      path_to_json: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json\n      model_name: bt_retry_v2\n      tree_nodes_only: 'False'\n      output_name: bt_retry_v2_score\n    outputs:\n      model_json_with_pd_path: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json\n      output_path: /projects/dnaomi/bt-retry-global-v2/models/ume/\n- Model Scoring:\n    file_name: rmr_agent/repos/bt-retry-v2/deployment/02_pyscoring_validation.py\n    line_range: 1-140\n    inputs:\n      numerical_columns: \"[\\\"setec_txn_amt_usd\\\", \\\"idi_bt_unbranded_retry_bin_rdd_cnt_pri_success_ratio_7d\\\"\\\n        , ...]\"\n      integer_columns: \"[]\"\n      categorical_columns: \"[\\\"merchant_fk\\\", \\\"setec_currency_code\\\", \\\"primary_response_type\\\"\\\n        , ...]\"\n      target_col: retry_is_success\n      MODELS_DIR: /home/dnaomi/bt-retry-global-refresh/models/ume/\n      MODEL_DIR: /home/dnaomi/bt-retry-global-refresh/models/ume/\n      MODEL_UME_NAME: bt_retry_v2\n      VALID_SAMPLE_PATH: /home/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv\n    outputs:\n      ume_predictions_valid: DataFrame with UME model predictions\n      ume_preds_filtered: DataFrame with filtered UME model predictions\n      scored_data_path: /projects/dnaomi/bt-retry-global-refresh/deployment/cosmos_ai_valid_data.csv\n\nedges:\n- from: Driver Creation 1\n  to: Model Evaluation\n  attributes:\n    Final Driver Table: pypl-edw.pp_scratch.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3\n- from: Driver Creation 2\n  to: Model Training\n  attributes:\n    target_gcs_path: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2\n- from: Model Training\n  to: Model Evaluation\n  attributes:\n    Model artifact path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt\n- from: Model Evaluation\n  to: Model Scoring\n  attributes:\n    valid_data_filtered_final.csv: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv\n- from: Model Packaging\n  to: Model Scoring\n  attributes:\n    output_path: /projects/dnaomi/bt-retry-global-v2/models/ume/"
}