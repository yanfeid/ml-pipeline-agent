nodes:
- Driver Creation:
    file_name: rmr_agent/repos/bt-retry-v2/etl/01_etl.py
    line_range: 1-1125
    inputs:
      strategy_type: '[''PAN'', ''NO_AVS'', ''NETWORK_TOKENIZATION'', ''ABU'']'
      created_at_start: '2023-08-15'
      created_at_end: '2025-01-02'
      sampling_factor: '15'
      date_range_start: '2023-01-01'
      date_range_end: '2025-01-02'
      currency_code: USD
      train_downsampling_factor: '900'
      validation_downsampling_factor_start: '900'
      validation_downsampling_factor_end: '950'
      test_downsampling_factor_start: '950'
    outputs:
      bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_3
      bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_3
      bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3
- Driver Creation 2:
    file_name: rmr_agent/repos/bt-retry-v2/etl/02_bq_to_dataproc.py
    line_range: 1-40
    inputs:
      source_table_name_train: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train
      source_table_name_valid: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid
      source_table_name_test: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test
    outputs:
      target_gcs_path_train: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_2
      target_gcs_path_valid: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_2
      target_gcs_path_test: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2
- Model Training:
    file_name: rmr_agent/repos/bt-retry-v2/model-dev/train.py
    line_range: 1-299
    inputs:
      v1_features_path: /projects/dnaomi/bt-retry-global-v2/metadata/v1_features.txt
      v1_latest_features_path: /projects/dnaomi/bt-retry-global-v2/metadata/v0_features_latest.txt
      v2_features_path: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features.txt
      train_parquet_path: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_train_3/
      val_parquet_path: /projects/dnaomi/bt-retry-global-v2/data/pypl-bods.gds_pacman_prod.bt_retry_global_v2_driverset_cc_renamed_radd_subset_filtered_full_valid_3/
      early_stopping_params: '{''stopping_rounds'': 10}'
      early_stopping_metric: average_precision
      metric_functions: '[''precision_at_95'', ''precision_at_99'', ''savings_at_95'',
        ''savings_at_99'', ''partial_aucpr_geq90'']'
      metric_names: '[''precision_at_95'', ''precision_at_99'', ''savings_at_95'',
        ''savings_at_99'', ''partial_aucpr_geq90'']'
      objective_metric_name: partial_aucpr_geq90
      target_col: retry_is_success
      best_params: '{''colsample_bytree'': 0.5837239684404587, ''learning_rate'':
        0.0598927112458938, ''min_child_samples'': 61, ''min_data_in_bin'': 25, ''num_leaves'':
        217, ''num_trees'': 141, ''n_estimators'': 141, ''n_jobs'': 8, ''reg_alpha'':
        4.784258485091152e-08, ''reg_lambda'': 0.0002699654851946926, ''subsample'':
        0.6899589770039457, ''subsample_freq'': 5}'
      tracking_url: https://mlflow.apps.cosmos-onprem.dp.lvs.paypalinc.com
      experiment_name: bt_retry_global_v2_full_fts_strategy_subset_model_all_strat_valid_control
      study_name: bt-retry-global-v1-full-fts-strategy-subset-model-all-strat-valid-control
      studies_dir: ../reports/studies/
      n_trials: '250'
    outputs:
      model_artifact_path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt
- Hyperparameter Tuning:
    file_name: rmr_agent/repos/bt-retry-v2/model-dev/train.py
    line_range: 300-367
    inputs:
      tracking_url: https://mlflow.apps.cosmos-onprem.dp.lvs.paypalinc.com
      experiment_name: bt_retry_global_v2_full_fts_strategy_subset_model_all_strat_valid_control
      study_name: bt-retry-global-v1-full-fts-strategy-subset-model-all-strat-valid-control
      studies_dir: ../reports/studies/
      n_trials: '250'
      objective_metric_name: partial_aucpr_geq90
    outputs: {}
- Model Evaluation:
    file_name: rmr_agent/repos/bt-retry-v2/model-dev/evaluate.py
    line_range: 1-383
    inputs:
      data_path: /projects/dnaomi/bt-retry-global-refresh/data/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3/
      v1_features_path: /projects/dnaomi/bt-retry-global-refresh/metadata/features_original.txt
      v1_model_path: /projects/dnaomi/bt-retry-global/models/lgbm/original_lgbm/original_model.txt
      v2_features_path: /projects/dnaomi/bt-retry-global-refresh/metadata/v2_features_final_2.txt
      v2_model_path: /projects/dnaomi/bt-retry-global-refresh/models/final/bt_retry_v2.txt
      metric_functions: '[''precision_at_95'', ''precision_at_99'', ''precision_at_995'',
        ''savings_at_95'', ''savings_at_99'', ''savings_at_995'', ''partial_aucpr_geq90'']'
      metric_names: '[''precision_at_95'', ''precision_at_99'', ''precision_at_995'',
        ''savings_at_95'', ''savings_at_99'', ''savings_at_995'', ''partial_aucpr_geq90'']'
      target_col: retry_is_success
    outputs:
      v1_metrics: calculated metrics for V1 model
      v2_metrics: calculated metrics for V2 model
      valid_data_filtered_path: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv
- Model Packaging:
    file_name: rmr_agent/repos/bt-retry-v2/deployment/01_export_to_ume.py
    line_range: 1-60
    inputs:
      full_features_path: /projects/dnaomi/bt-retry-global-v2/metadata/v2_features_final_2.txt
      model_file_path: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_small.txt
      path_to_json: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json
    outputs:
      model_json_with_pd_path: /projects/dnaomi/bt-retry-global-v2/models/bt_retry_v2_model_idi.json
      output_path: /projects/dnaomi/bt-retry-global-v2/models/ume/
- Model Scoring:
    file_name: rmr_agent/repos/bt-retry-v2/deployment/02_pyscoring_validation.py
    line_range: 1-140
    inputs:
      models_dir: /home/dnaomi/bt-retry-global-refresh/models/ume/
      model_dir: /home/dnaomi/bt-retry-global-refresh/models/ume/
      model_ume_name: bt_retry_v2
      valid_sample_path: /home/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv
      features_path: /projects/dnaomi/bt-retry-global-refresh/metadata/v2_features_final_2.txt
    outputs:
      scored_data_path: /projects/dnaomi/bt-retry-global-refresh/deployment/cosmos_ai_valid_data.csv

edges:
- from: Driver Creation
  to: Driver Creation 2
  attributes:
    bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_3
    bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_3
    bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3: pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_3
- from: Driver Creation 2
  to: Model Training
  attributes:
    target_gcs_path_train: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_train_2
    target_gcs_path_valid: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_valid_2
    target_gcs_path_test: gs://pypl-bkt-rsh-row-std-gds-pacman/user/dnaomi/bt_retry_refresh/pypl-bods.gds_pacman_prod.bt_retry_global_refresh_driverset_cc_renamed_radd_subset_filtered_full_test_2
- from: Model Training
  to: Model Evaluation
  attributes:
    model_artifact_path: /projects/dnaomi/bt-retry-global-v2/models/final/bt_retry_v2.txt
- from: Model Evaluation
  to: Model Scoring
  attributes:
    valid_data_filtered_path: /projects/dnaomi/bt-retry-global-refresh/deployment/valid_data_filtered_final.csv